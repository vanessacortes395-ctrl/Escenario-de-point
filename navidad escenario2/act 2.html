<!DOCTYPE html> 
<html lang="en"> 
<head> 
    <title>ESCENARIO</title>
    <style>
        body {
              margin: 0;
              overflow: hidden;
          }
          #boton {
            position: absolute;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            font-size: 40px;
            cursor: pointer;
          }
          #activ {
            color: rgba(9, 245, 9, 0.87);
          }
     </style>

    <script type="importmap">
    {
    "imports": {
        "three": "./js/three.module.js",
        "three/OrbitControls": "./js/OrbitControls.js",
        "three/PointerLockControls": "./js/PointerLockControls.js",
        "three/interactive": "./js/three.interactive.js"
      }
    }
    </script>
</head>
<body>

  <div id="boton">
    PARA COMENZAR DA CLIC EN + PARA ACTIVAR <p id="activ" > ( )</p> MIRA AL REDEDOR USANDO EL MOUSE, PULSA ESC PARA PARAR
  </div>

  <canvas id="myCanvas"></canvas>
  <!--El elemento HTML canvas se puede utilizar para dibujar graficas y secuencias de comandos(por lo general JavaScript) .-->

<script type="module"> 

//ðŸ—ƒï¸ðŸ—ƒï¸ Mandar llamar a la librerÃ­a
import * as THREE from 'three'; 
import { InteractionManager } from 'three/interactive';//aÃ±ade libreria itneractiva
import { TWEEN } from './js/tween.module.min.js'; // Libreria movimiento suave
import { PointerLockControls } from 'three/PointerLockControls'; //control de camara
//import {OrbitControls} from 'three/OrbitControls';
//console.log(OrbitControls);
import { TextGeometry } from "./js/TextGeometry.js";
import { FontLoader } from "./js/FontLoader.js";
import arbol from "./objetos/arbol.js";
import casa from "./objetos/casa.js";
import piÃ±ata from "./objetos/piÃ±ata.js";
import santa from "./objetos/santa.js";
import BolaDeNieve from "./objetos/BolaDeNieve.js";
import Vela from "./objetos/vela.js";
import Campana from "./objetos/Campana.js";
import corona from "./objetos/corona.js";
//ðŸ•¹ï¸ðŸ•¹ï¸ Renderer - Realiza una conexiÃ³n entre el cÃ³digo y el canvas
var renderer = new THREE.WebGLRenderer({
  canvas: document.getElementById('myCanvas'), antialias: true,
});
renderer.setPixelRatio(window.devicePixelRatio);
renderer.setSize(window.innerWidth, window.innerHeight);
window.addEventListener("resize", () => {
  camera.aspect = window.innerWidth / window.innerHeight;
  camera.updateProjectionMatrix();
  renderer.setSize(window.innerWidth, window.innerHeight);
});
//FONDO
renderer.setClearColor(0xD1C2CF);

// ////ðŸŽ¥ðŸŽ¥ Agregar una cÃ¡mara de perspectiva
// ConfiguraciÃ³n de cÃ¡mara y escenario ######        
var camera = new THREE.PerspectiveCamera(50, window.innerWidth / window.innerHeight, .1, 1000);
camera.position.set(0, 3, 6);

// agregar el pointlock ########
var controls = new PointerLockControls( camera, renderer.domElement );
var boton = document.getElementById('boton');
document.getElementById('activ').onclick = () => {
  controls.lock();
};
controls.addEventListener( 'lock', function () {
  boton.style.display = 'none';
} );
controls.addEventListener( 'unlock', function () {
  boton.style.display = '';
} );

// AÃ±adir interactionManager #######
var interactionManager = new InteractionManager(
  renderer,
  camera,
  renderer.domElement
);

// Crear la escena (solo una vez)
var scene = new THREE.Scene(); 

//helpers (comentados)
//var gridHelper = new THREE.GridHelper(50,50);
//var gridHelper = new THREE.PolarGridHelper(20,16,20,64);
//var gridHelper = new THREE.AxesHelper(500);

// LUCES
const ambientLight = new THREE.AmbientLight(0xffffff, 0.4);
scene.add(ambientLight);
var light1= new THREE.DirectionalLight(0Xffffff,0.8);
light1.position.set (50,50,50);
scene.add(light1);

//  Fondo
const loader = new THREE.TextureLoader();
scene.background = loader.load('./assets/fondo.png');

// BASE
const geometryBase = new THREE.BoxGeometry(500, 0.1, 500);
const materialBase = new THREE.MeshLambertMaterial({ map: loader.load('./assets/piso.png') });
const meshBase = new THREE.Mesh(geometryBase, materialBase);
meshBase.position.set(0, -1, 0);
meshBase.castShadow = true;
scene.add(meshBase);

// OBJETOS


//piÃ±ata
var miPiÃ±ata= piÃ±ata({ x: -80, y: 0.6, z: 80 });
scene.add(miPiÃ±ata);
interactionManager.add(miPiÃ±ata);
miPiÃ±ata.scale.set(3, 3, 3);
miPiÃ±ata.rotation.z=-0.157;

miPiÃ±ata.addEventListener('mouseover', (event) => {  //Evento para cuando colocamos el cursor sobre la figura
          document.body.style.cursor = 'pointer';
          event.target.scale.set(2,2,2);
});

miPiÃ±ata.addEventListener('mouseout', (event) => {  //evento para cuando quitas el cursor de la figura, si no se agrega se le quedara el color que se puso en el mouseover
           document.body.style.cursor = 'default';
           event.target.scale.set(1, 1, 1);
        });

        miPiÃ±ata.addEventListener('click', (event) => { //evento para cuando se suelta el clic
          var coords = { x: camera.position.x, y: camera.position.y, z: camera.position.z };// se crea un objeto para "contener" las coordenadas
          event.target.scale.set(1.0, 1.0, 1.0);
          new TWEEN.Tween(coords) //Se declara el TWEEN, que permite que los movimientos sean fluidos y no de golpe 
          .to({x:-80, y: 3, z: 64}) //se indican los cambios que se presentaran y en que variables, INDICA LA POSICIÃ“N FINAL DE MOVIMIENTO
          .onUpdate(() => camera.position.set(coords.x,coords.y,coords.z )  //Se actualizan las vartiables en el objetivo del movimiento SE ACTUALIZAN LAS VARIABLES EN LA CAMARA
          )
          .start();//El movimiento inicia
        });


// arbol
var miArbol = arbol({ x: 80, y: 0.6, z: 80 });
scene.add(miArbol);
interactionManager.add(miArbol);
miArbol.scale.set(3, 3, 3);

miArbol.addEventListener('mouseover', (event) => {
  document.body.style.cursor = 'pointer';
  event.target.scale.set(3.5, 3.5, 3.5);
});
miArbol.addEventListener('mouseout', (event) => {
  document.body.style.cursor = 'default';
  event.target.scale.set(3, 3, 3);
});
miArbol.addEventListener('click', (event) => {
  var coords = { x: camera.position.x, y: camera.position.y, z: camera.position.z };
  event.target.scale.set(3, 3, 3);
  new TWEEN.Tween(coords)
    .to({ x: 80, y: 3, z: 59 }) 
    .onUpdate(() => camera.position.set(coords.x, coords.y, coords.z))
    .start();
});


// Casa
const miCasa = casa({ x: 80, y: 0.6, z: -80 });
scene.add(miCasa);
interactionManager.add(miCasa);
miCasa.scale.set(3, 3, 3);

miCasa.addEventListener('mouseover', (event) => {
  document.body.style.cursor = 'pointer';
  event.target.scale.set(3.5, 3.5, 3.5);
});
miCasa.addEventListener('mouseout', (event) => {
  document.body.style.cursor = 'default';
  event.target.scale.set(3, 3, 3);
});
miCasa.addEventListener('click', (event) => {
  var coords = { x: camera.position.x, y: camera.position.y, z: camera.position.z };
  event.target.scale.set(3, 3, 3);
  new TWEEN.Tween(coords)
    .to({ x: 80, y: 3, z: -60 })
    .onUpdate(() => camera.position.set(coords.x, coords.y, coords.z))
    .start();
});


// santa
const miSanta = santa({ x: -80, y: 0.6, z:-80 });
scene.add(miSanta);
interactionManager.add(miSanta);
miSanta.scale.set(3, 3, 3);
//miSanta.rotation.y = -1.57;

miSanta.addEventListener('mouseover', (event) => {
  document.body.style.cursor = 'pointer';
  event.target.scale.set(3.5, 3.5, 3.5);
});
miSanta.addEventListener('mouseout', (event) => {
  document.body.style.cursor = 'default';
  event.target.scale.set(3, 3, 3);
});
miSanta.addEventListener('click', (event) => {
  var coords = { x: camera.position.x, y: camera.position.y, z: camera.position.z };
  event.target.scale.set(3, 3, 3);
  new TWEEN.Tween(coords)
    .to({ x: -80, y: 3, z: -60 })
    .onUpdate(() => camera.position.set(coords.x, coords.y, coords.z))
    .start();
});

// BOLA DE NIEVE
const miBola = BolaDeNieve({ x: 50, y: 0.6, z:50 });
scene.add(miBola);
interactionManager.add(miBola);
miBola.scale.set(3, 3, 3);

//VELA
const miVela = Vela({ x: -50, y: 0.6, z:-50 });
scene.add(miVela);
interactionManager.add(miVela);
miVela.scale.set(3, 3, 3);

//CAMPANA
const miCampana = Campana({ x: -50, y: 0.6, z:-30 });
scene.add(miCampana);
interactionManager.add(miCampana);
miCampana.scale.set(3, 3, 3);


//// CRUZ CENTRAL QUE SIRVE DE GUIA
        var geometryx = new THREE.BoxGeometry(.0050, .03, .060);
        var materialx = new THREE.MeshNormalMaterial({side:THREE.DoubleSide});
        var meshx = new THREE.Mesh(geometryx, materialx);
        meshx.position.set(0,0,-1);
        var geometryx2 = new THREE.BoxGeometry(.03, .0050, .060);
        var meshx2 = new THREE.Mesh(geometryx2, materialx);
        meshx2.position.set(0,0,-1);
        scene.add( camera );
        camera.add( meshx, meshx2 );


//ðŸŽ°ðŸŽ°Rendering y animaciÃ³n
      requestAnimationFrame(render);
      function render() {

    TWEEN.update()  //se agrega la transiciÃ³n del tween a functionrender para que genere la animaciÃ³n el movimiento suave

    interactionManager.update();////// sedebe actualizar el interaction manager en las animaciones

     //ðŸª„ðŸª„ AnimaciÃ³n - 

      //Llamado para renderizar y volver a llamar a la misma funciÃ³n (render)
      renderer.render(scene, camera);
      requestAnimationFrame(render);
      }

    //ðŸª„ðŸª„ AnimaciÃ³n - 

    //ðŸŽ®ðŸŽ®ActualizaciÃ³n del OrbitControls para generar la suavidad de movimiento
    //controls.update();
    
</script>
</body>
</html>